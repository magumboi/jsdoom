<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS DOOM ðŸ•¹</title>
    <link rel="stylesheet" type="text/css" href="./style.css">
    <link rel="stylesheet" type="text/css" href="./styles/button.css">
</head>

<body>
    <div class="container">
        <div id="dosbox"></div>
        <button class="wrapper" onclick="dosbox.requestFullScreen();">
            <a><span>FULLSCREEN</span></a>
        </button>
    </div>

    <script type="text/javascript" src="./script.js"></script>
    <script type="text/javascript">
        var dosbox = new Dosbox({
            id: "dosbox",
            onload: function (dosbox) {
                dosbox.run("/jsdoom/roms/ultimate-doom.zip", "./UltDoom/DOOM.EXE");
            },
            onrun: function (dosbox, app) {
                console.log("App '" + app + "' is runned");
            }
        });

        // Automatically click the dosbox-start button after first user interaction
        var hasUserInteracted = false;
        var dosboxReady = false;
        
        function tryAutoStart() {
            if (hasUserInteracted && dosboxReady) {
                var startButton = document.querySelector('.dosbox-start');
                if (startButton) {
                    startButton.click();
                    console.log("Auto-clicked dosbox-start button with audio support");
                } else {
                    console.log("dosbox-start button not found");
                }
            }
        }
        
        // Wait for first user interaction (click, touch, or key press)
        function enableAutoStart() {
            hasUserInteracted = true;
            console.log("User interaction detected, enabling auto-start");
            tryAutoStart();
            // Remove the event listeners since we only need one interaction
            document.removeEventListener('click', enableAutoStart);
            document.removeEventListener('touchstart', enableAutoStart);
            document.removeEventListener('keydown', enableAutoStart);
        }
        
        document.addEventListener('click', enableAutoStart);
        document.addEventListener('touchstart', enableAutoStart);
        document.addEventListener('keydown', enableAutoStart);
        
        // Wait for dosbox to be ready
        window.addEventListener('load', function() {
            setTimeout(function() {
                dosboxReady = true;
                console.log("Dosbox ready, waiting for user interaction");
                tryAutoStart();
            }, 500);
        });
    </script>
</body>

</html>
